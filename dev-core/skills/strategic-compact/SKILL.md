---
name: strategic-compact
description: |
  このスキルは、ユーザーが「コンテキスト」「圧縮」「コンパクト」「メモリ」「トークン」について質問したとき、またはコンテキスト最適化が必要なときに使用する。
---

# Strategic Compact

## コンテキスト管理の重要性

Claude Code の 200k トークンウィンドウは、多くの MCP ツールや大きなファイルを読み込むと急速に消費されます。戦略的なコンテキスト管理が重要です。

## コンテキスト最適化戦略

### 1. 必要最小限の読み込み

```
✅ 良い例:
- 必要な関数のみを含むファイルを読み込む
- 大きなファイルは必要な部分のみ読み込む

❌ 悪い例:
- プロジェクト全体を一度に読み込む
- 関係ないファイルを読み込む
```

### 2. MCP サーバーの選択的有効化

```
⚠️ 警告:
全 MCP を同時に有効化すると、200k → 70k に縮小する可能性

推奨:
- プロジェクトごとに必要な MCP のみ有効化
- 同時有効化は 10 個以下を推奨
```

### 3. 完了タスクのコンテキスト圧縮

タスク完了後は不要なコンテキストを圧縮：

- 中間ファイルの内容
- デバッグログ
- 試行錯誤の履歴

## PreCompact フック

コンテキスト圧縮前に重要な情報を保存：

```json
{
  "PreCompact": [
    {
      "matcher": ".*",
      "hooks": [
        {
          "type": "prompt",
          "prompt": "圧縮前に現在の作業状態を要約してください"
        }
      ]
    }
  ]
}
```

### 保存すべき情報

1. **現在のタスク**: 取り組んでいる作業
2. **完了ステップ**: 完了した作業
3. **次のアクション**: 次に実行すべきこと
4. **重要なコンテキスト**: ファイルパス、設定等

## 圧縮タイミング

### 自動圧縮のトリガー

- コンテキスト使用率が 80%を超えた場合
- 長時間の作業後
- タスク切り替え時

### 手動圧縮の推奨

- 大きなタスクが完了した後
- 新しいタスクを開始する前
- デバッグ作業が完了した後

## 状態復元

圧縮後も作業を継続するための情報：

```markdown
## 作業状態サマリー

### 現在のタスク

[タスクの説明]

### 完了ステップ

1. [完了したステップ 1]
2. [完了したステップ 2]

### 次のアクション

- [次のアクション 1]
- [次のアクション 2]

### 重要なコンテキスト

- ファイル: [重要なファイルパス]
- 設定: [重要な設定]
- 注意点: [覚えておくべきこと]
```

## ベストプラクティス

1. **定期的な圧縮**: 長時間作業時は定期的に圧縮
2. **状態の明示的な保存**: 重要な情報は明示的に記録
3. **不要な読み込みを避ける**: 必要なファイルのみ読み込む
4. **MCP の選択的有効化**: 必要な MCP のみ有効化
