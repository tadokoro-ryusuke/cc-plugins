---
allowed-tools: Task(subagent_type:refactoring-specialist), Task(subagent_type:quality-checker), Bash(git:*), Bash(gh:*), Bash(pnpm:*), Bash(npm:*), Bash(yarn:*), Read(*.ts,*.tsx,*.md), Glob
description: "ä½œæ¥­ä¸­ã®å¤‰æ›´ã€PRã€ãƒ–ãƒ©ãƒ³ãƒã€ã¾ãŸã¯æœ€è¿‘ã®å¤‰æ›´ã«å¯¾ã—ã¦ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œã—ã¾ã™"
argument-hint: "[ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥|PRç•ªå·|ãƒ–ãƒ©ãƒ³ãƒå|ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª] (çœç•¥æ™‚ã¯ç¾åœ¨ã®å¤‰æ›´)"
---

# ã‚³ãƒ¼ãƒ‰ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°

**é‡è¦**: é–‹å§‹å‰ã« `dev-core:best-practices` ã‚¹ã‚­ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€TDD/FSD/Clean Architecture/DDD ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…ã®éš›ã¯ `frontend-design` ã‚¹ã‚­ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚

## æ¦‚è¦

Martin Fowler ã¨ T-wada ã®åŸå‰‡ã«åŸºã¥ã„ãŸãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
å¯¾è±¡ã¯ç¾åœ¨ã®å¤‰æ›´ã€PRã€ãƒ–ãƒ©ãƒ³ãƒã€ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€ã¾ãŸã¯æœ€è¿‘ã®å¤‰æ›´ã‹ã‚‰é¸æŠã§ãã¾ã™ã€‚

## å®Ÿè¡Œãƒ•ãƒ­ãƒ¼

### 1. å¯¾è±¡ã®ç‰¹å®š

```bash
# å¼•æ•°ãªã—: ç¾åœ¨ã®æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´
if [ -z "$ARGUMENTS" ]; then
  echo "ğŸ” ç¾åœ¨ã®å¤‰æ›´ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯¾è±¡ã¨ã—ã¾ã™"
  git diff --name-only | grep -E '\.(ts|tsx)$'

# PRç•ªå·ã®å ´åˆï¼ˆ#123 ã¾ãŸã¯ 123ï¼‰
elif [[ "$ARGUMENTS" =~ ^#?[0-9]+$ ]]; then
  PR_NUMBER="${ARGUMENTS#\#}"
  echo "ğŸ” PR #$PR_NUMBER ã®å¤‰æ›´ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯¾è±¡ã¨ã—ã¾ã™"

  # PRã®æƒ…å ±ã‚’å–å¾—
  PR_INFO=$(gh pr view $PR_NUMBER --json baseRefName,headRefName)
  BASE_BRANCH=$(echo $PR_INFO | jq -r '.baseRefName')
  HEAD_BRANCH=$(echo $PR_INFO | jq -r '.headRefName')

  # PRã®å·®åˆ†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
  git fetch origin $HEAD_BRANCH
  git diff --name-only origin/$BASE_BRANCH...origin/$HEAD_BRANCH | grep -E '\.(ts|tsx)$'

# ãƒ•ã‚¡ã‚¤ãƒ«/ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å ´åˆ
elif [ -e "$ARGUMENTS" ]; then
  echo "ğŸ” $ARGUMENTS ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯¾è±¡ã¨ã—ã¾ã™"

# ãƒ–ãƒ©ãƒ³ãƒåã¾ãŸã¯ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã®å ´åˆ
elif git rev-parse --verify $ARGUMENTS >/dev/null 2>&1; then
  if git show-ref --verify --quiet refs/heads/$ARGUMENTS; then
    echo "ğŸ” ãƒ–ãƒ©ãƒ³ãƒ $ARGUMENTS ã®å¤‰æ›´ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯¾è±¡ã¨ã—ã¾ã™"
    BASE_BRANCH=$(git symbolic-ref refs/remotes/origin/HEAD | sed 's@^refs/remotes/origin/@@')
    git diff --name-only $BASE_BRANCH...$ARGUMENTS | grep -E '\.(ts|tsx)$'
  else
    echo "ğŸ” ã‚³ãƒŸãƒƒãƒˆ $ARGUMENTS ã®å¤‰æ›´ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¯¾è±¡ã¨ã—ã¾ã™"
    git diff --name-only $ARGUMENTS^ $ARGUMENTS | grep -E '\.(ts|tsx)$'
  fi

# å¼•æ•°æŒ‡å®šãªã—ã§æœ€è¿‘ã®å¤‰æ›´ã‚’è‡ªå‹•æ¤œå‡º
else
  echo "ğŸ” æœ€è¿‘å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•æ¤œå‡ºï¼ˆéå»5ã‚³ãƒŸãƒƒãƒˆï¼‰"
  git diff --name-only HEAD~5..HEAD | grep -E '\.(ts|tsx)$'
fi
```

### 2. äº‹å‰ãƒã‚§ãƒƒã‚¯

1. **ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ**

   ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šã«å¾“ã£ã¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `pnpm test`ï¼‰

   ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒã‚°ãƒªãƒ¼ãƒ³ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

2. **ç¾åœ¨ã®å“è³ªçŠ¶æ…‹**

   lint ã¨ typecheck ã‚’å®Ÿè¡Œ

### 3. ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Ÿè¡Œ

refactoring-specialist ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã—ï¼š

```
å¯¾è±¡: [TARGET]

ä»¥ä¸‹ã®è¦³ç‚¹ã§ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼š

1. ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã¸ã®æº–æ‹ 
2. é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®æ’é™¤ï¼ˆDRYåŸå‰‡ï¼‰
3. å˜ä¸€è²¬ä»»ã®åŸå‰‡ï¼ˆSRPï¼‰ã®é©ç”¨
4. æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³/ã‚¬ãƒ¼ãƒ‰ç¯€ã®æ´»ç”¨
5. æ˜ç¢ºã§æ„å›³ãŒä¼ã‚ã‚‹å‘½åã¸ã®æ”¹å–„
6. ãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼ã®å®šæ•°åŒ–
7. useEffectã®å‰Šé™¤ã¨ä»£æ›¿å®Ÿè£…ã¸ã®ç½®ãæ›ãˆ
   - Server Components/Server Actions
   - ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
   - useSWR/Tanstack Query
   - Zustand
8. å†—é•·ãªã‚³ãƒ¼ãƒ‰ã¯åˆ†å‰²ã—ã¦ç°¡æ½”ã«ã™ã‚‹ã“ã¨

PRãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å ´åˆã®è¿½åŠ è€ƒæ…®äº‹é …ï¼š
- ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã§æŒ‡æ‘˜ã•ã‚Œã‚‹å‰ã«å“è³ªæ”¹å–„
- PRã®ã‚µã‚¤ã‚ºãŒå¤§ãã„å ´åˆã¯æ®µéšçš„ã«å®Ÿè¡Œ
- CIã§æ¤œå‡ºã•ã‚Œã‚‹å‰ã«lint/typechecké•åã‚’ä¿®æ­£
```

### 4. å„ªå…ˆé †ä½

ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã¯ä»¥ä¸‹ã®å„ªå…ˆé †ä½ã§å®Ÿè¡Œï¼š

1. **Criticalï¼ˆå¿…é ˆï¼‰**
   - ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®é™¤å»
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ã®è§£æ¶ˆ
   - æ˜ã‚‰ã‹ãªãƒã‚°ã®ä¿®æ­£
   - **useEffect ã®é™¤å»**: ãƒã‚°ã®æ¸©åºŠã¨ãªã‚‹ useEffect ã‚’ä»£æ›¿æ‰‹æ®µã«ç½®ãæ›ãˆ

2. **Highï¼ˆé«˜å„ªå…ˆåº¦ï¼‰**
   - é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®çµ±åˆ
   - è¤‡é›‘ãªæ¡ä»¶å¼ã®ç°¡ç•¥åŒ–
   - é•·å¤§ãªé–¢æ•°ã®åˆ†å‰²

3. **Mediumï¼ˆä¸­å„ªå…ˆåº¦ï¼‰**
   - å‘½åã®æ”¹å–„
   - ä¸è¦ãªã‚³ãƒ¡ãƒ³ãƒˆã®å‰Šé™¤
   - ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æ•´ç†

4. **Lowï¼ˆä½å„ªå…ˆåº¦ï¼‰**
   - ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®æ•´ç†
   - ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®çµ±ä¸€
   - å‹å®šç¾©ã®æ”¹å–„

### 5. TDD ã‚µã‚¤ã‚¯ãƒ«ã® Refactor ãƒ•ã‚§ãƒ¼ã‚ºã¨ã—ã¦å®Ÿè¡Œ

- **å‰æ**: ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒã‚°ãƒªãƒ¼ãƒ³
- **ç›®çš„**: ã‚³ãƒ¼ãƒ‰å“è³ªã®å‘ä¸Šï¼ˆå‹•ä½œã¯å¤‰æ›´ã—ãªã„ï¼‰
- **çµæœ**: ãƒ†ã‚¹ãƒˆãŒå¼•ãç¶šãã‚°ãƒªãƒ¼ãƒ³

### 6. å“è³ªç¢ºèªã¨ã‚³ãƒŸãƒƒãƒˆ

1. **ãƒ†ã‚¹ãƒˆå†å®Ÿè¡Œ**
2. **å“è³ªãƒã‚§ãƒƒã‚¯**ï¼ˆquality-checker ä½¿ç”¨ï¼‰
3. **å·®åˆ†ã®ç¢ºèª**
   ```bash
   git diff
   ```
4. **ã‚³ãƒŸãƒƒãƒˆ/ãƒ—ãƒƒã‚·ãƒ¥**
   ```bash
   git add .
   git commit -m "refactor: [å¤‰æ›´å†…å®¹ã®èª¬æ˜]"

   # PRã®å ´åˆã¯å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥
   git push origin $HEAD_BRANCH

   # PRã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   gh pr comment $PR_NUMBER --body "ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼š
   - useEffectã®å‰Šé™¤
   - ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„ã¸ã®æº–æ‹ 
   - é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®çµ±åˆ"
   ```

## å®Ÿè¡Œä¾‹

```bash
# ç¾åœ¨ã®å¤‰æ›´ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
/dev-core:refactor

# PRç•ªå·ã§ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
/dev-core:refactor #123
/dev-core:refactor 123

# ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
/dev-core:refactor src/features/client-management/ui/ClientForm.tsx

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“
/dev-core:refactor src/features/client-management/

# ãƒ–ãƒ©ãƒ³ãƒã®å¤‰æ›´ã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
/dev-core:refactor feature/add-user-auth

# ç‰¹å®šã®ã‚³ãƒŸãƒƒãƒˆã‚’ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
/dev-core:refactor abc123f
```

## æ³¨æ„äº‹é …

- **å‹•ä½œã‚’å¤‰æ›´ã—ãªã„**: å¤–éƒ¨ã‹ã‚‰è¦‹ãŸå‹•ä½œã¯ç¶­æŒ
- **ãƒ†ã‚¹ãƒˆã‚’å¸¸ã«ã‚°ãƒªãƒ¼ãƒ³ã«**: å„ã‚¹ãƒ†ãƒƒãƒ—ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
- **æ®µéšçš„ã«å®Ÿè¡Œ**: ä¸€åº¦ã«å¤§ããªå¤‰æ›´ã‚’é¿ã‘ã‚‹
- **YAGNI åŸå‰‡**: å°†æ¥ã®æ‹¡å¼µã‚’éåº¦ã«è€ƒæ…®ã—ãªã„

### useEffect ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å…·ä½“ä¾‹

```typescript
// âŒ æ‚ªã„ä¾‹ï¼šuseEffect
useEffect(() => {
  fetchData().then(setData);
}, []);

// âœ… è‰¯ã„ä¾‹1ï¼šServer Component
async function Component() {
  const data = await fetchData();
  return <div>{data}</div>;
}

// âœ… è‰¯ã„ä¾‹2ï¼šã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
function handleClick() {
  fetchData().then(setData);
}

// âœ… è‰¯ã„ä¾‹3ï¼šãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ©ã‚¤ãƒ–ãƒ©ãƒª
const { data } = useSWR("/api/data", fetcher);
```

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.claude/*.local.mdï¼‰ã‚’ç¢ºèªã—ã€è¿½åŠ ãƒ„ãƒ¼ãƒ«ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’æ´»ç”¨ã—ã¦ãã ã•ã„ã€‚
ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œã‚’å¤‰ãˆãšã«ã€å“è³ªã¨ä¿å®ˆæ€§ã‚’å‘ä¸Šã•ã›ã¾ã™ã€‚
å¾¹åº•çš„ã«è¡Œãªã£ã¦ãã ã•ã„ã€‚

ultrathink
